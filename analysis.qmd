---
title: Analysis
description: This page presents an in-depth statistical exploration of graduation outcomes across Massachusetts school districts.
toc: true
draft: false
---

![](https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg)

```{r}
#| echo: false
#| message: false
#| warning: false
library(tidyverse)
library(broom)
library(dplyr)
library(knitr)
library(ggplot2)
library(tidyr)
Combined_District_Data <- read.csv("dataset/Combined_District_Data.csv")
df <- readRDS("dataset/Combined_District_Data.rds")
```

# 1. Motivation and Research Question

Educational outcomes are significantly influenced by a complex interplay of racial demographics, socioeconomic factors, and financial investments. In Massachusetts, public school districts exhibit varied graduation rates and SAT performances.

### Research Questions
- How do financial investments per student correlate with graduation rates?
- How do racial composition and income levels affect educational outcomes?
- What models best explain the observed variations?

### Guiding Question
> **How do funding and structural inequalities together shape graduation outcomes across school districts?**


# 2. General Information Analysis

### Summary Statistics


```{r}
#| echo: false
#| message: false

library(dplyr)
library(knitr)
Combined_District_Data <- readRDS("dataset/Combined_District_Data.rds") %>%
  mutate(
    Total_Expenditures_Per_Pupil = as.numeric(Total_Expenditures_Per_Pupil),
    Percent_Minority = 100 - Percent_White
  )



summary_table <- tibble(
  Category = c(
    "Graduation", "Graduation",
    "Expenditure", "Expenditure",
    "Demographics", "Demographics",
    "Resources", "Resources",
    "Size", "Size"
  ),
  Metric = c(
    "Avg Graduation Rate (%)", "SD Graduation Rate (%)",
    "Avg Expenditure per Pupil (USD)", "SD Expenditure (USD)",
    "Avg % Minority Students", "Avg % Low-Income Students",
    "Avg Student-Teacher Ratio", "SD Student-Teacher Ratio",
    "Avg Cohort Size", "SD Cohort Size"
  ),
  Value = c(
    mean(Combined_District_Data$Percent_Graduated, na.rm = TRUE) %>% round(1),
    sd(Combined_District_Data$Percent_Graduated, na.rm = TRUE) %>% round(1),
    mean(Combined_District_Data$Total_Expenditures_Per_Pupil, na.rm = TRUE) %>% round(1),
    sd(Combined_District_Data$Total_Expenditures_Per_Pupil, na.rm = TRUE) %>% round(1),
    mean(Combined_District_Data$Percent_Minority, na.rm = TRUE) %>% round(1),
    mean(Combined_District_Data$Low_Income_Percent, na.rm = TRUE) %>% round(1),
    mean(Combined_District_Data$Student_Teacher_Ratio, na.rm = TRUE) %>% round(1),
    sd(Combined_District_Data$Student_Teacher_Ratio, na.rm = TRUE) %>% round(1),
    mean(Combined_District_Data$Cohort_Size, na.rm = TRUE) %>% round(1),
    sd(Combined_District_Data$Cohort_Size, na.rm = TRUE) %>% round(1)
  )
)

kable(summary_table, caption = "Summary Statistics of Key Variables")


```

**Observation**: Across Massachusetts districts, the average graduation rate is high (91.4%), though notable variation remains.  
Per-pupil expenditure averages around \$15,348, but districts differ substantially in resources and demographics.  
On average, about 19.4% of students are from minority backgrounds and 32.7% are low-income, reflecting persistent socioeconomic diversity that may influence outcomes.


# 3. Initial Exploratory Analysis

### 3.1 Distribution of Graduation Rates


Although Massachusetts districts generally exhibit **high graduation rates**, the right-skewed distribution suggests that a **small subset of districts consistently underperform**.  
This highlights that **structural inequalities** persist despite overall strong outcomes.


```{r}
#| echo: false
library(ggplot2)
ggplot(Combined_District_Data, aes(x = Percent_Graduated)) +
  geom_density(fill = "skyblue", alpha = 0.6) +
  geom_rug(alpha = 0.3) +
  labs(title = "Distribution of Graduation Rates",
       subtitle = "Graduation rates are right-skewed with a high concentration above 70%",
       x = "Graduation Rate (%)",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```


> **Big Picture Implication:**  
> Even with an overall high graduation rate, **not all districts benefit equally**, suggesting that systemic factors such as **racial and economic disparities** continue to impact student success.



### 3.2 Distribution of Per-Pupil Expenditure


The distribution of per-pupil expenditure shows **substantial variation**, with most districts spending moderately but some spending considerably more.  
This reflects **unequal financial investment** across districts, reinforcing the connection between **resource allocation** and graduation outcomes.


```{r}
#| echo: false
Combined_District_Data <- readRDS("dataset/Combined_District_Data.rds")
ggplot(Combined_District_Data, aes(x = Total_Expenditures_Per_Pupil)) +
  geom_density(fill = "lightgreen", alpha = 0.6) +
  geom_rug(alpha = 0.3) +
  labs(title = "Distribution of Per-Pupil Expenditure",
       subtitle = "Per-pupil expenditure varies widely across districts",
       x = "Expenditure Per Pupil ($)",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

```


> **Big Picture Implication:**  
> **Funding disparities** likely play a key role in graduation gaps, but **expenditure alone may not fully address deeper structural inequalities**.


### 3.3 Racial Composition Across Districts


The racial composition across Massachusetts districts shows a **high concentration of White students**, with most districts having a **predominantly White population**.  
In contrast, the percentages of Asian, Black, and Hispanic students are generally low, with most districts having **less than 10%** representation for these groups.


```{r}
#| echo: false
library(dplyr)
library(tidyr)
df_long <- Combined_District_Data %>%
  select(Percent_White, Percent_Black, Percent_Hispanic, Percent_Asian) %>%
  pivot_longer(cols = everything(), names_to = "Race", values_to = "Percent") %>%
  mutate(Race = gsub("Percent_", "", Race))

ggplot(df_long, aes(x = Percent)) +
  geom_density(fill = "lightcoral", alpha = 0.6) +
  facet_wrap(~ Race, scales = "free") +
  labs(title = "Distribution of Racial Composition Across Districts",
       subtitle = "Each panel shows the distribution of one racial group's percentage",
       x = "Percentage",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```


> **Big Picture Implication:**  
> The **racial imbalance** across districts suggests persistent **segregation and structural inequalities**. Districts with higher minority populations may face systemic challenges that affect graduation outcomes and resource allocation.


### 3.4 Minority Composition vs. Per-Pupil Expenditure


> **Definition of Minority Students:**  
> In this analysis, “Minority Students” are defined as the combined percentage of individuals identifying as Black, Hispanic, Asian, Multi-Race, American Indian, or Pacific Islander within each district.  
> The total minority percentage is calculated by summing the proportions of these six groups.

The scatter plot examines the relationship between minority student percentages and per-pupil expenditure across Massachusetts districts from 2006 to 2013.

While a slight positive trend exists, the relationship is **weak and highly scattered**.  
Most districts have low minority percentages (below 30%), and expenditure levels vary widely across all minority levels.  
This indicates that **minority composition alone does not explain funding disparities**.


```{r, echo=FALSE}
#| echo: false
#| message: false

library(dplyr)
library(ggplot2)

Combined_District_Data <- Combined_District_Data %>%
  mutate(
    Total_Expenditures_Per_Pupil = as.numeric(Total_Expenditures_Per_Pupil),
    Percent_Minority = Percent_Black + Percent_Hispanic + Percent_Asian + Percent_Multi_Race
  )


ggplot(Combined_District_Data, aes(x = Percent_Minority, y = Total_Expenditures_Per_Pupil)) +
  geom_point(alpha = 0.5, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE, color = "darkred", linewidth = 1) +
  labs(
    title = "Relationship Between Minority Composition and Per-Pupil Expenditure",
    subtitle = "Each point represents a district (2006–2013)",
    x = "Percent Minority Students (%)",
    y = "Total Expenditures Per Pupil (USD)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )

```


> **Big Picture Implication:**  
> While racial composition is an important dimension of structural inequality, it does not fully explain disparities in school funding.  
> The observed variation implies that **other systemic factors** — such as **poverty concentration, urbanization, historical segregation patterns, and political resource allocation** — likely play more significant roles in shaping funding inequities across districts.


# 4. Regression Analysis

We estimate three types of linear models to investigate the relationship between spending and graduation rates:

- Simple linear regression
- Multiple linear regression
- Log-log regression

## 4.1 Simple Linear Regression: Spending vs Graduation


A simple linear regression estimates the association between total expenditures per pupil and graduation rates across Massachusetts districts.


### 4.1.1 Scatterplot and Regression Line


```{r}
#| echo: false
#| warning: false
library(tidyverse)


# Load data
df <- readRDS("dataset/Combined_District_Data.rds")

# Create scatterplot
ggplot(df, aes(x = Total_Expenditures_Per_Pupil, y = Percent_Graduated)) +
  geom_jitter(width = 500, height = 1, alpha = 0.4, color = "darkblue") +
  geom_smooth(method = "lm", se = FALSE, color = "red", size = 1) +
  labs(
    title = "Graduation Rate vs. Per-Pupil Expenditure",
    subtitle = "Higher spending slightly correlates with higher graduation rates",
    x = "Total Expenditures Per Pupil ($)",
    y = "Graduation Rate (%)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```


::: {.blockquote}
**Interpretation:**

- **Higher per-pupil spending is positively associated** with graduation rates.
- However, **the relationship appears weak and dispersed**, especially at lower spending levels.
- **Graduation rates are heavily concentrated between 85%–100%**, suggesting that **factors beyond spending** likely drive performance.
:::

### 4.1.2 Linear Regression Model


```{r}
#| echo: false
#| warning: false
library(broom)
library(knitr)
library(kableExtra)

model_spending <- lm(Percent_Graduated ~ Total_Expenditures_Per_Pupil, data = df)

model_spending_result <- tidy(model_spending) %>%
  mutate(p.value = ifelse(p.value < 0.01, "<0.01", round(p.value, 4)))

model_spending_summary <- glance(model_spending) %>%
  mutate(p.value = ifelse(p.value < 0.01, "<0.01", round(p.value, 4)))

kable(model_spending_result, caption = "Simple Linear Regression Coefficients", digits = 4) %>%
  kable_styling(full_width = F)

kable(model_spending_summary[, c("r.squared", "adj.r.squared", "p.value")],
      caption = "Model Summary Statistics", digits = 4) %>%
  kable_styling(full_width = F)
```


::: {.callout-note}
**Interpretation:**

- The **intercept (87.83)** indicates that districts with zero reported per-pupil expenditure would have a predicted graduation rate of about **87.8%**, although such extrapolation is not practically meaningful.
- The **coefficient for per-pupil spending (0.0002)** implies that **each additional \$10,000 investment per pupil** is associated with an approximately **2.0 percentage point increase** in graduation rates.
- **Both the intercept and the spending coefficient are highly statistically significant** (p < 0.01), suggesting that the observed associations are unlikely due to random chance.
- However, the **R-squared value is extremely low (1.34%)**, indicating that **per-pupil spending explains only a very small portion** of the variance in graduation rates across districts.
- **Conclusion:** While there is a statistically detectable relationship, **spending alone is far from sufficient** to account for differences in student outcomes.
:::



### 4.1.3 Regression by Majority Race Group

Separate regression models are estimated for school districts grouped by their majority racial composition to assess whether the impact of spending differs across demographic contexts.


::: {.callout-note}
Only Majority White, Black, and Hispanic groups are shown here due to sufficient sample sizes. Other groups are omitted to ensure stable regression estimates.
:::


```{r}
#| echo: false
#| warning: false

df <- df %>%
  rowwise() %>%
  mutate(
    majority_race = c(
      "White", "Black", "Hispanic", "Asian", 
      "American Indian", "Pacific Islander", "Multi Race"
    )[which.max(c_across(c(
      Percent_White, Percent_Black, Percent_Hispanic, 
      Percent_Asian, Percent_American_Indian, 
      Percent_Pacific_Islander, Percent_Multi_Race
    )))]
  ) %>%
  ungroup() %>%
  mutate(majority_race = paste("Majority", majority_race))

library(broom)
group_models_spending <- df %>%
  group_by(majority_race) %>%
  nest() %>%
  mutate(
    model = map(data, ~lm(Percent_Graduated ~ Total_Expenditures_Per_Pupil, data = .x)),
    glance = map(model, glance)
  )

library(knitr)
group_results <- group_models_spending %>%
  select(majority_race, glance) %>%
  unnest(glance) %>%
  filter(majority_race %in% c("Majority White", "Majority Black", "Majority Hispanic")) %>%
  mutate(p.value = ifelse(p.value < 0.01, "<0.01", sprintf("%.4f", p.value)))  # ✨防止类型冲突

kable(group_results[, c("majority_race", "r.squared", "p.value")],
      caption = "Regression Results by Majority Race Group", digits = 4) %>%
  kable_styling(full_width = F)

```


::: {.blockquote}
**Interpretation:**

Although all three groups show statistically significant relationships (p < 0.05), the strength of association differs:

- **Majority Hispanic** districts have the highest R-squared (0.1696), suggesting a stronger link between spending and graduation rates.
- **Majority Black** districts also show a notable relationship (R-squared = 0.1497).
- **Majority White** districts have a much weaker association (R-squared = 0.0281).

These results imply that **increased spending may have a greater marginal impact** in districts serving historically underserved racial groups.
:::


## 4.2 Simple Regression: Low-Income Percentage and Graduation Rates

A simple linear regression estimates the association between the percentage of low-income students and graduation rates across Massachusetts districts.


### 4.2.1 Scatterplot and Regression Line


```{r}
#| echo: false
#| warning: false
options(scipen = 0)
library(tidyverse)

# Load data
df <- readRDS("dataset/Combined_District_Data.rds")

# Create scatterplot
ggplot(df, aes(x = Low_Income_Percent, y = Percent_Graduated)) +
  geom_jitter(width = 2, height = 1, alpha = 0.4, color = "darkgreen") +
  geom_smooth(method = "lm", se = FALSE, color = "red", size = 1) +
  labs(
    title = "Graduation Rate vs. Low-Income Student Percentage",
    subtitle = "Higher low-income concentration correlates with lower graduation rates",
    x = "Low-Income Student Percentage (%)",
    y = "Graduation Rate (%)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```


::: {.blockquote}
**Interpretation:**

Higher percentages of low-income students are associated with noticeably lower graduation rates.
The negative slope of the regression line suggests that as low-income concentration increases, graduation outcomes decline.
The relationship appears stronger than in the previous spending model, with a clearer downward trend.
:::


### 4.2.2 Linear Regression Model


```{r}
#| echo: false
#| warning: false
library(broom)
library(knitr)
library(kableExtra)

model_simple2 <- lm(Percent_Graduated ~ Low_Income_Percent, data = df)
model_simple2_result <- tidy(model_simple2)
model_simple2_summary <- glance(model_simple2)

# Update p-values display
model_simple2_result <- model_simple2_result %>%
  mutate(p.value = ifelse(p.value < 0.01, "<0.01", round(p.value, 4)))

model_simple2_summary <- model_simple2_summary %>%
  mutate(p.value = ifelse(p.value < 0.01, "<0.01", round(p.value, 4)))

kable(model_simple2_result, caption = "Simple Linear Regression Coefficients", digits = 4, format.args = list(scientific = FALSE)) %>%
  kable_styling(full_width = F)

kable(model_simple2_summary[, c("r.squared", "adj.r.squared", "p.value")],
      caption = "Model Summary Statistics", digits = 4, format.args = list(scientific = FALSE)) %>%
  kable_styling(full_width = F)
```


::: {.blockquote}
**Interpretation:**

The regression analysis shows a strong negative relationship between the percentage of low-income students and graduation rates. For every 1 percentage point increase in low-income concentration, the graduation rate declines by about 0.29 points. The relationship is highly statistically significant (p < 0.01). The model explains around 61% of the variation in graduation rates (R² = 0.6145), suggesting that socioeconomic disadvantage is a major driver of educational outcomes across districts.
:::


### 4.2.3 Regression by Majority Race Group


```{r}
#| echo: false
#| warning: false
# Assign majority race
df <- df %>%
  rowwise() %>%
  mutate(
    majority_race = c(
      "White", "Black", "Hispanic", "Asian", 
      "American Indian", "Pacific Islander", "Multi Race"
    )[which.max(c_across(c(
      Percent_White, 
      Percent_Black, 
      Percent_Hispanic, 
      Percent_Asian, 
      Percent_American_Indian, 
      Percent_Pacific_Islander, 
      Percent_Multi_Race
    )))]
  ) %>%
  ungroup() %>%
  mutate(
    majority_race = paste("Majority", majority_race)
  )

table(df$majority_race)
```

```{r}
#| echo: false
library(broom)

# Regression models by majority race group
group_models_lowincome <- df %>%
  group_by(majority_race) %>%
  nest() %>%
  mutate(
    model = map(data, ~lm(Percent_Graduated ~ Low_Income_Percent, data = .x)),
    glance = map(model, glance)
  )

# Summarize results
group_results_lowincome <- group_models_lowincome %>%
  select(majority_race, glance) %>%
  unnest(glance) %>%
  filter(majority_race %in% c("Majority White", "Majority Black", "Majority Hispanic")) %>%
  mutate(p.value = ifelse(p.value < 0.01, "<0.01", round(p.value, 4)))

kable(group_results_lowincome[, c("majority_race", "r.squared", "p.value")],
      caption = "Regression Results by Majority Race Group (Low-Income Model)", digits = 4, format.args = list(scientific = FALSE)) %>%
  kable_styling(full_width = F)
```

## 4.3 Log-Log Regression: Elasticity Interpretation


---



```{r}
#| echo: false
df <- df %>% mutate(log_expenditure = log(Total_Expenditures_Per_Pupil),
                    log_graduated = log(Percent_Graduated))
model_loglog <- lm(log_graduated ~ log_expenditure + Percent_White + Percent_Black + Percent_Hispanic + Percent_Asian + Percent_Female + Student_Teacher_Ratio + Low_Income_Percent + SAT_Reading_Writing_Mean_Score + SAT_Math_Mean_Score, data = df)
kable(tidy(model_loglog), caption = "Log-Log Regression Results", digits = 4)
```


- Results are consistent.
- Interpretation: A **1% increase** in spending predicts a **small % increase** in graduation rates.


## 4.4 Model Comparison
```{r}
#| echo: false
#| eval: false

library(broom)

model_metrics <- tibble(
  Model = c("Simple Regression", "Multiple Regression", "Log-Log Regression"),
  R_Squared = c(summary(model_spending)$r.squared, summary(model_multiple)$r.squared, summary(model_loglog)$r.squared),
  Adjusted_R_Squared = c(summary(model_spending)$adj.r.squared, summary(model_multiple)$adj.r.squared, summary(model_loglog)$adj.r.squared),
  AIC = c(AIC(model_spending), AIC(model_multiple), AIC(model_loglog)),
  BIC = c(BIC(model_spending), BIC(model_multiple), BIC(model_loglog)),
  RMSE = c(sqrt(mean(model_spending$residuals^2)),
           sqrt(mean(model_multiple$residuals^2)),
           sqrt(mean(model_loglog$residuals^2)))
)

kable(model_metrics, caption = "Comprehensive Model Comparison", digits = 4)

```

-The three models differ substantially in their explanatory power and efficiency:

Simple Linear Regression:
This model shows a very low R-squared (~1.3%), indicating that per-pupil expenditure alone explains very little of the variation in graduation rates. While the coefficient is statistically significant, the model’s predictive ability is poor.

Multiple Linear Regression:
After adding controls for race, income, SAT scores, and other district characteristics, the R-squared increases substantially (~67%). This suggests that educational outcomes are driven by a broader range of factors beyond spending. However, the increase in model complexity must be weighed against the risk of overfitting.

Log-Log Regression:
The log-log model achieves a slightly lower R-squared (~64%) compared to the multiple linear model but still captures a strong relationship. Log-transforming the data stabilizes variance and reduces the influence of extreme values. Additionally, interpreting elasticities (percentage changes) can provide more policy-relevant insights.

Comparing AIC and BIC values also favors the multiple linear model, indicating a better fit with reasonable complexity.
RMSE is lowest for the multiple regression, confirming better predictive accuracy.

In short, while simple models highlight basic associations, richer models reveal that multiple factors — especially demographics and socioeconomic status — jointly shape graduation outcomes.



# 5. Limitations

- **Causality:** Observational data limits causal inference.
- **Omitted Variables:** Factors like school leadership and parental involvement are not included.
- **Measurement Error:** Graduation rates and expenditures may be reported with inaccuracies.
- **Cross-Sectional Data:** No dynamic effects are captured.

# 6. Conclusion

Spending is positively associated with graduation outcomes, with stronger effects in minority-majority districts. However, many factors beyond funding shape educational success. Future research should adopt causal designs and investigate targeted interventions.



