---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
---

![](https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg)

```{r}
#| echo: false
#| message: false
#| warning: false
library(tidyverse)
library(broom)
df <- readRDS("dataset/Combined_District_Data.rds")
```

# 1. Motivation and Research Question

Massachusetts consistently ranks among the top states in educational performance. However, excellence in averages can mask disparities across districts. This analysis investigates how **resources (expenditure)** and **structural factors (race, income, academic background)** interact to influence graduation outcomes.

**Guiding question:**

> How do funding and structural inequalities together shape graduation outcomes across school districts?

## 2. General Information Analysis

We use district-level data from 2006–2013, including:

- **Total Expenditures Per Pupil**
- **Graduation Rates**
- **Demographics** (Percent White, Black, Hispanic, Asian)
- **Socioeconomic Indicators** (Low Income Percentage)
- **Academic Preparedness** (SAT Scores)
- **Student-Teacher Ratio**


# 3. Initial Exploratory Analysis

### 3.1 Distribution of Graduation Rates


```{r}
#| echo: false
library(ggplot2)
ggplot(df, aes(x = Percent_Graduated)) +
  geom_density(fill = "skyblue", alpha = 0.6) +
  geom_rug(alpha = 0.3) +
  labs(title = "Distribution of Graduation Rates",
       x = "Graduation Rate (%)",
       y = "Density") +
  theme(plot.title = element_text(hjust = 0.5))

```


### 3.2 Distribution of Per-Pupil Expenditure


```{r}
#| echo: false
ggplot(df, aes(x = Total_Expenditures_Per_Pupil)) +
  geom_density(fill = "lightgreen", alpha = 0.6) +
  geom_rug(alpha = 0.3) +
  labs(title = "Distribution of Per-Pupil Expenditure",
       x = "Expenditure Per Pupil ($)",
       y = "Density") +
  theme(plot.title = element_text(hjust = 0.5))

```


### 3.3 Racial Composition Across Districts


```{r}
#| echo: false
library(dplyr)
library(tidyr)
df_long <- df %>%
  select(Percent_White, Percent_Black, Percent_Hispanic, Percent_Asian) %>%
  pivot_longer(cols = everything(), names_to = "Race", values_to = "Percent") %>%
  mutate(Race = gsub("Percent_", "", Race))

ggplot(df_long, aes(x = Race, y = Percent, color = Race)) +
  geom_jitter(width = 0.2, alpha = 0.5) +
  stat_summary(fun = median, geom = "crossbar", width = 0.5, color = "black") +
  labs(title = "Racial Composition Across Districts",
       x = "Race Group",
       y = "Percentage") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))
```


# 4. Regression Analysis

We estimate three types of linear models to investigate the relationship between spending and graduation rates:

- Simple linear regression
- Multiple linear regression
- Log-log regression

## 4.1 Simple Linear Regression: Spending vs Graduation


```{r}
#| echo: false
library(broom)
library(knitr)
model_simple <- lm(Percent_Graduated ~ Total_Expenditures_Per_Pupil, data = df)
kable(tidy(model_simple), caption = "Simple Linear Regression Results", digits = 4)
```


- A $10,000 increase in spending is associated with a **2.3 percentage point increase** in graduation rates.
- **However**, this model explains only about **1.3% of the variance** (very low R-squared), indicating that spending alone cannot account for differences in graduation rates.


```{r}
#| echo: false
ggplot(df, aes(x = Total_Expenditures_Per_Pupil, y = Percent_Graduated)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", color = "blue", se = FALSE) +
  labs(title = "Graduation Rate vs. Per-Pupil Expenditure",
       x = "Per-Pupil Expenditure ($)",
       y = "Graduation Rate (%)") +
  theme(plot.title = element_text(hjust = 0.5))
```


## 4.2 Multiple Linear Regression: Adding Controls

```{r}
#| echo: false
model_multiple <- lm(Percent_Graduated ~ Total_Expenditures_Per_Pupil + Percent_White + Percent_Black + Percent_Hispanic + Percent_Asian + Percent_Female + Student_Teacher_Ratio + Low_Income_Percent + SAT_Reading_Writing_Mean_Score + SAT_Math_Mean_Score, data = df)
kable(tidy(model_multiple), caption = "Multiple Regression Results", digits = 4)
```


- After controlling for race, income, academic preparedness, and class size, **model fit improves dramatically** (R² ~ 67%).
- Racial composition, income, and SAT scores are strong additional predictors.


## 4.3 Log-Log Regression: Elasticity Interpretation


```{r}
#| echo: false
df <- df %>% mutate(log_expenditure = log(Total_Expenditures_Per_Pupil),
                    log_graduated = log(Percent_Graduated))
model_loglog <- lm(log_graduated ~ log_expenditure + Percent_White + Percent_Black + Percent_Hispanic + Percent_Asian + Percent_Female + Student_Teacher_Ratio + Low_Income_Percent + SAT_Reading_Writing_Mean_Score + SAT_Math_Mean_Score, data = df)
kable(tidy(model_loglog), caption = "Log-Log Regression Results", digits = 4)
```


- Results are consistent.
- Interpretation: A **1% increase** in spending predicts a **small % increase** in graduation rates.


## 4.4 Model Comparison
```{r}
#| echo: false
library(broom)

model_metrics <- tibble(
  Model = c("Simple Regression", "Multiple Regression", "Log-Log Regression"),
  R_Squared = c(summary(model_simple)$r.squared, summary(model_multiple)$r.squared, summary(model_loglog)$r.squared),
  Adjusted_R_Squared = c(summary(model_simple)$adj.r.squared, summary(model_multiple)$adj.r.squared, summary(model_loglog)$adj.r.squared),
  AIC = c(AIC(model_simple), AIC(model_multiple), AIC(model_loglog)),
  BIC = c(BIC(model_simple), BIC(model_multiple), BIC(model_loglog)),
  RMSE = c(sqrt(mean(model_simple$residuals^2)),
           sqrt(mean(model_multiple$residuals^2)),
           sqrt(mean(model_loglog$residuals^2)))
)

kable(model_metrics, caption = "Comprehensive Model Comparison", digits = 4)

```

The three models differ substantially in their explanatory power and efficiency:

Simple Linear Regression:
This model shows a very low R-squared (~1.3%), indicating that per-pupil expenditure alone explains very little of the variation in graduation rates. While the coefficient is statistically significant, the model’s predictive ability is poor.

Multiple Linear Regression:
After adding controls for race, income, SAT scores, and other district characteristics, the R-squared increases substantially (~67%). This suggests that educational outcomes are driven by a broader range of factors beyond spending. However, the increase in model complexity must be weighed against the risk of overfitting.

Log-Log Regression:
The log-log model achieves a slightly lower R-squared (~64%) compared to the multiple linear model but still captures a strong relationship. Log-transforming the data stabilizes variance and reduces the influence of extreme values. Additionally, interpreting elasticities (percentage changes) can provide more policy-relevant insights.

Comparing AIC and BIC values also favors the multiple linear model, indicating a better fit with reasonable complexity.
RMSE is lowest for the multiple regression, confirming better predictive accuracy.

In short, while simple models highlight basic associations, richer models reveal that multiple factors — especially demographics and socioeconomic status — jointly shape graduation outcomes.

# 5. Subgroup Analysis: Racial Composition


To explore if the relationship between funding and outcomes differs across racial groups, we estimated models separately by majority racial composition.

```{r}
#| echo: false
library(purrr)

df <- df %>%
  rowwise() %>%
  mutate(majority_race = c("White", "Black", "Hispanic", "Asian", "American Indian", "Pacific Islander", "Multi Race")[which.max(c_across(c(Percent_White, Percent_Black, Percent_Hispanic, Percent_Asian, Percent_American_Indian, Percent_Pacific_Islander, Percent_Multi_Race)))]) %>%
  ungroup() %>%
  mutate(majority_race = paste("Majority", majority_race))

group_models <- df %>%
  group_by(majority_race) %>%
  nest() %>%
  mutate(
    model = map(data, ~lm(Percent_Graduated ~ Total_Expenditures_Per_Pupil, data = .x)),
    results = map(model, tidy)
  )

race_results <- group_models %>%
  select(majority_race, results) %>%
  unnest(results)

kable(race_results, caption = "Subgroup Regression Results by Race", digits = 4)
```


### Key Findings:
- **Majority Hispanic districts:** Strongest positive relationship between spending and graduation.
- **Majority Black districts:** Moderate positive relationship.
- **Majority White districts:** Positive but smaller magnitude.

> ➔ Targeted funding could have greater returns in historically underserved communities.


# 5. Limitations

- **Causality:** Observational data limits causal inference.
- **Omitted Variables:** Factors like school leadership and parental involvement are not included.
- **Measurement Error:** Graduation rates and expenditures may be reported with inaccuracies.
- **Cross-Sectional Data:** No dynamic effects are captured.

# 6. Conclusion

Spending is positively associated with graduation outcomes, with stronger effects in minority-majority districts. However, many factors beyond funding shape educational success. Future research should adopt causal designs and investigate targeted interventions.



